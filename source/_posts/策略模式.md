---
title: ç­–ç•¥æ¨¡å¼
date: 2017-03-27 12ï¼š43
tags: ['è®¾è®¡æ¨¡å¼', 'JavaScript']
categories: è®¾è®¡æ¨¡å¼
---
è¯´å‡ºæ¥å¯èƒ½ä¸ä¿¡ï¼Œæˆ‘ä»¥å‰å†™çš„æ–‡ç« å…¨éƒ½æä¸¢äº† ğŸ˜­ã€‚ hexo ç”Ÿæˆçš„é¡¹ç›®æ²¡æœ‰å¥½å¥½ä¿å­˜ï¼Œç”µè„‘ recovery ä¹‹åå°±ä¸¢å¤±äº†ä¹‹å‰é¡¹ç›®ä»¥åŠ post çš„ md æ–‡ä»¶ ...

ç°åœ¨çš„ blog å¥½ç©ºå•Š â€¦ è¶ç©ºé—²å†™ä¸€ç¯‡è®¾è®¡æ¨¡å¼ - ç­–ç•¥æ¨¡å¼çš„æ–‡ç« å……å……æ•°å§

<!-- more -->

## æ¨¡å¼åŠ¨æœº

ä¸ºäº†è¾¾åˆ°ä¸€ä¸ªç›®çš„ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰å¤šç§æ–¹æ³•å»å®ç°ï¼Œé€‰æ‹©ä»€ä¹ˆæ ·çš„ç­–ç•¥æˆ–è€…ç­–ç•¥ç»„åˆå¯ä»¥æ ¹æ®ç¯å¢ƒæˆ–è€…æ¡ä»¶è®©ä½¿ç”¨è€…å»è‡ªç”±é€‰æ‹©ã€‚

eg:

è¡¨å•éªŒè¯

```javascript
function validate (value, type) {
  switch (type){
    case 'username':
      if (!value) {
        console.log('ç”¨æˆ·åä¸èƒ½ä¸ºç©º')
      } else if (value.length < 6) {
        console.log('ç”¨æˆ·åçš„é•¿åº¦ä¸èƒ½å°äº 6 ä½')
      } else {
        console.log(`ç”¨æˆ·å - ${value}`)
        break
      }
    case 'pwd':
      if (!value) {
        console.log('å¯†ç ä¸èƒ½ä¸ºç©º')
      } else if (value.length !== 4 || value.length !== 6) {
        console.log('å¯†ç é•¿åº¦å¿…é¡»ä¸º 4 ä½ æˆ–è€… 6 ä½')
      } else {
        console.log(`å¯†ç  - ${value}`)
        break
      }
    default:
      console.error('æ— å¯¹åº”ç±»å‹éªŒè¯')
  }
}
// ç”¨æˆ·åéªŒè¯
var username = document.querySelector('#username').value
validate(username, 'username')
// å¯†ç éªŒè¯
var pwd = document.querySelector('#password').value
validate(pwd, 'pwd')
```

å¯¹äºä¸Šä¾‹ä¸­ï¼Œè°ƒç”¨è€…çš„å‡ºå‘ç‚¹æ˜¯è·å¾—ä¸€ä¸ª `Input` è¾“å…¥æ¡†è¾“å…¥å€¼ï¼Œç³»ç»Ÿç»™ç”¨æˆ·è¾“å‡ºçš„æ˜¯è¾“å…¥å€¼çš„å›é¦ˆï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æœ‰è®¸å¤šæ–¹æ³•å¯ä»¥ç”¨äºéªŒè¯ç”¨æˆ·è¾“å…¥çš„å€¼ã€‚è€Œè¿™äº›æ–¹æ³•åœ¨ä¸ç»è¿‡è®¾è®¡çš„æƒ…å†µä¸‹ï¼Œå°±æ˜¯ä¸€å¤§æ®µä¸€å¤§æ®µçš„ `if...else` æ··æ‚ç€ä¸šåŠ¡é€»è¾‘å……æ–¥ç€æˆ‘ä»¬çš„ä»£ç ï¼Œäºæ˜¯ç­–ç•¥æ¨¡å¼æ­£æ˜¯åŸºäºè¿™æ ·çš„åœºæ™¯ä¸‹è¯ç”Ÿçš„ã€‚

## æ¨¡å¼å®šä¹‰

å®šä¹‰ä¸€ç³»åˆ—ç®—æ³•ï¼Œå°†æ¯ä¸€ä¸ªç®—æ³•åŒ…è£…èµ·æ¥ï¼Œå¹¶è®©å®ƒä»¬å¯ä»¥äº’ç›¸æ›¿æ¢ã€‚

å±äºè¡Œä¸ºå‹æ¨¡å¼ã€‚

## å…·ä½“å®ç°

å…³äºç­–ç•¥æ¨¡å¼çš„ UML å›¾å’Œæ—¶åºå›¾ï¼Œå¯ä»¥å‚è€ƒä¸‹é¢ä¸¤å›¾ï¼Œæ¥è‡ªäº [Graphic Design Patterns](https://design-patterns.readthedocs.io/zh_CN/latest/index.html) :

![](http://oe3rjg2g6.bkt.clouddn.com/strategy-uml.png)



ä» UML å›¾æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬éœ€è¦æ„å»ºçš„çš„ç±»ç»“æ„

```javascript
// ç­–ç•¥æŠ½è±¡ç±»
class Strategy {
  constructor () {}
  excute () {
    ...
  }
}
// ç­–ç•¥ A
class ConcreteStrategyA extends Strategy {
  constructor () {
    super()
  }
  excute () {
    ...
  }
}
// ç­–ç•¥ B
class ConcreteStrategyB extends Strategy {
  constructor () {
    super()
  }
  excute () {
    ...
  }
}
// æ‰§è¡Œç±»
class Context {
  constructor () {
    this.strategies = []
  }
  excute () {
    for (let strategy of strategies) {
      strategy.excute()
    }
  }
  setStrategy (strategy) {
    if (strategy instanceof Strategy) {
      this.strategies.push(strategy)
    } else {
      console.error('éç­–ç•¥å¯¹è±¡ï¼')
    }
  }
}
```

è¿™æ˜¯ä¼ ç»Ÿçš„é¢å‘å¯¹è±¡èŒƒå¼ä¸‹æ„é€ å‡ºæ¥çš„ç±»ç»“æ„ï¼Œå…¶å®åœ¨ JS ä¸­æˆ‘ä»¬æ²¡å¿…è¦å¦‚æ­¤éº»çƒ¦çš„ ...



![](http://oe3rjg2g6.bkt.clouddn.com/strategy-time.png)

ä»æ—¶åºå›¾æˆ‘ä»¬å¯ä»¥å¾—åˆ°å…·ä½“æ‰§è¡Œçš„ä»£ç ç»“æ„

```javascript
function main () {
  var context = new Context()
  var strategyA = new ConcreteStrategyA()
  var strategyB = new ConcreteStrategyB()
  context.setStrategy(strategyA)
  context.excute()
  context.setStrategy(strategyB)
  context.excute()
}
```

ä»æœ€åˆç”¨ `swtich...case` åŠ ä¸Š `if...else` å®ç°çš„ä»£ç ï¼Œåˆ°ç°åœ¨ç»è¿‡ç­–ç•¥æ¨¡å¼è®¾è®¡åçš„ä»£ç æˆ‘ä»¬å¯ä»¥æ¸…æ™°çœ‹åˆ°å·®åˆ«æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š

- å¯¹äºä½¿ç”¨è€…è€Œè¨€ï¼Œä½¿ç”¨å“ªç§ç­–ç•¥ä»–æ˜¯éå¸¸æ¸…æ™°çš„ï¼Œä½†æ˜¯ä»–å¹¶ä¸éœ€è¦çœŸçš„äº†è§£ç­–ç•¥çš„å…·ä½“å®ç°ã€‚å› æ­¤æˆ‘ä»¬è§£è€¦äº†ç­–ç•¥çš„è°ƒç”¨ & ç­–ç•¥çš„å®ç°ä¸¤ä¸ªè¿‡ç¨‹ã€‚
- å¯¹äºæ–°å¢ç­–ç•¥ï¼Œä½¿ç”¨è€…ä¸éœ€è¦å»æ”¹åŠ¨æ‰§è¡Œè¿‡ç¨‹çš„ä»£ç ï¼Œåªéœ€è¦æ–°å¢ä¸€ä¸ªè‡ªå·±æƒ³è¦çš„ç­–ç•¥ç±»å³å¯ã€‚
- å¯¹äºç­–ç•¥ç»„åˆçš„ä½¿ç”¨ä¹Ÿæ›´åŠ çµæ´»ï¼Œå¯ä»¥ä¸€ä¸ªä¸€ä¸ªç­–ç•¥å»éªŒè¯ï¼Œä¹Ÿå¯ä»¥ç»„åˆå¥½ä¸€ç»„ç­–ç•¥ç„¶åå†å»æ‰§è¡Œã€‚

## æ¡ˆä¾‹

ä»¥è¡¨å•éªŒè¯ä¸ºæ¡ˆä¾‹ï¼Œå®ç°ç­–ç•¥æ¨¡å¼ï¼š

```javascript
/**
 * [è¡¨å•ç­–ç•¥ç»„]
 * @type {Object}
 */
let formStrategies = {
  /**
   * [ç©ºå€¼åˆ¤æ–­]
   * @param  {[Any]}     val [æ ¡éªŒå€¼]
   * @param  {[String]}  msg [é”™è¯¯ä¿¡æ¯]
   */
  isEmpty: (val, msg) => {
    if (!val) {
      return msg
    }
  },
  /**
   * [ç‰¹å®šå€¼åˆ¤æ–­ï¼Œä¸¥æ ¼åˆ¤æ–­]
   * @param  {[String]}    val           [æ ¡éªŒå€¼]
   * @param  {[String]}    assignedVal   [å¯¹æ¯”å€¼]
   * @param  {[String]}    msg           [é”™è¯¯ä¿¡æ¯]
   */
  eqAssignedVal: (val, assignedVal, msg) => {
    if (val !== assignedVal) {
      return msg
    }
  },
  /**
   * [æœ€å°å€¼åˆ¤æ–­ï¼Œé™ Number]
   * @param  {[String]}    val  [æ ¡éªŒå€¼]
   * @param  {[String]}    min  [å¯¹æ¯”å€¼]
   * @param  {[String]}    msg  [é”™è¯¯ä¿¡æ¯]
   */
  ltMinVal: (val, min, msg) => {
    let parseVal = parseFloat(val)
    let parseMin = parseFloat(min)
    if (isNaN(parseVal) || isNaN(parseMin) || parseVal < parseMin) {
      return msg
    }
  },
  /**
   * [æœ€å¤§å€¼åˆ¤æ–­ï¼Œé™ Number]
   * @param  {[String]}   val   [æ ¡éªŒå€¼]
   * @param  {[String]}   max   [å¯¹æ¯”å€¼]
   * @param  {[String]}   msg   [é”™è¯¯ä¿¡æ¯]
   */
  gtMaxVal: (val, max, msg) => {
    let parseVal = parseFloat(val)
    let parseMax = parseFloat(max)
    if (isNaN(parseVal) || isNaN(parseMax) || parseVal > parseMax) {
      return msg
    }
  },
  /**
   * [æ‰‹æœºå·æ ¼å¼åˆ¤æ–­]
   * @param  {[String]}   val   [æ ¡éªŒå€¼]
   * @param  {[String]}   msg   [é”™è¯¯ä¿¡æ¯]
   */
  isMobile: (val, msg) => {
    if (!(/^1[34578]\d{9}$/.test(val))) {
      return msg
    }
  },
  /**
   * [éªŒè¯ç æ ¼å¼æ ¡éªŒ]
   * @param  {[String]} val [æ ¡éªŒå€¼]
   * @param  {[String]} msg [é”™è¯¯ä¿¡æ¯]
   */
  isSms: (val, msg) => {
    if (!/^\d{6}$/.test(val)) {
      return msg
    }
  },
  /**
   * [éªŒè¯å€¼æ˜¯å¦ä¸ºæ•´ç™¾æ•°æ®æ ¼å¼]
   * @param  {[String]} val [æ ¡éªŒå€¼]
   * @param  {[String]} msg [é”™è¯¯ä¿¡æ¯]
   */
  isHundredInterge: (val, msg) => {
    if (!/^\w+00$/.test(val)) {
      return msg
    }
  },
  /**
   * [éªŒè¯å€¼æ˜¯å¦æ˜¯æ•´æ•°]
   * @param  {[Number]} val [æ ¡éªŒå€¼]
   * @param  {[String]} msg [é”™è¯¯ä¿¡æ¯]
   */
  isInterge: (val, msg) => {
    if (val % 1 !== 0) {
      return msg
    }
  }
}

/**
 * è¡¨å•ç­–ç•¥ç»„æ‰§è¡Œç±»
 */
class FormValidate {
  /*
   * cache éªŒè¯è§„åˆ™ç¼“å­˜
   */
  constructor () {
    this.cache = []
  }
  /**
   * [æ·»åŠ éªŒè¯è§„åˆ™]
   * @param {[String]}   val     [æ ¡éªŒå€¼]
   * @param {[Array]}   rules    [éªŒè¯è§„åˆ™ï¼Œç­–ç•¥ç»„ä¸­å¿…é¡»å­˜åœ¨è¯¥è§„åˆ™]
   */
  add (val, rules) {
    for (let rule of rules) {
      let strategyAry = rule.strategy.split(':')
      let msg = rule.msg
      this.cache.push(() => {
        let strategy = strategyAry.shift()
        strategyAry.unshift(val)
        strategyAry.push(msg)
        return formStrategies[strategy].apply(this, strategyAry)
      })
    }
  }
  /**
   * [éªŒè¯è§„åˆ™å»¶è¿Ÿæ‰§è¡Œ]
   */
  start () {
    for (let validateFunc of this.cache) {
      let msg = validateFunc()
      if (msg) {
        return msg
      }
    }
  }
}

export default FormValidate

// å…·ä½“è°ƒç”¨å®ç°
let fv = new FormValidate()
let username = document.querySelector('#username').value
let pwd = document.querySelector('#password').value
fv.add(username, [{
  strategy: 'isEmpty',
  msg: 'æ‰‹æœºå·ä¸èƒ½ä¸ºç©º'
}, {
  strategy: 'isMobile',
  msg: 'æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®'
}])

fv.add(password, [{
  strategy: 'ltMinVal:6',
  msg: 'å¯†ç é•¿åº¦ä¸èƒ½å°‘äº 6 ä½'
}, {
  strategy: 'gtMaxVal:20',
  msg: 'å¯†ç é•¿åº¦ä¸èƒ½å¤šäº 20 ä½'
}])

let msg = fv.start()
if (msg) {
  console.error(msg)
} else {
  ...
}
```

ä»¥ä¸Šæ˜¯æˆ‘ç°åœ¨åœ¨å…¬å¸é¡¹ç›®å¯¹æ•´ç«™åšçš„ä¸€ä¸ªè¡¨å•ç­–ç•¥éªŒè¯çš„å°è£…ã€‚



***

> [å›¾è§£ç­–ç•¥æ¨¡å¼](https://design-patterns.readthedocs.io/zh_CN/latest/behavioral_patterns/strategy.html)

