---
title: Canvas - ribbon
date: 2017-07-07 14ï¼š30
tags: ['Canvas', 'JavaScript']
categories: Canvas
---

è¿™ä¸ªæ•ˆæœç¬¬ä¸€æ¬¡é‡è§è¿˜æ˜¯åœ¨å°¤é›¨æºªçš„ blog ä¸Šçœ‹åˆ°çš„ï¼Œç»™äººæ„Ÿè§‰éå¸¸å¥½ã€‚
æœ‰ç§ä½è°ƒçš„è£…äº†é€¼çš„æ„Ÿè§‰ ğŸ˜¶

<iframe width="100%" height="300" src="//jsfiddle.net/swarosky44/e6v17ohr/embedded/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

<!-- more -->
## åŸºæœ¬åŸç†
åœ¨ codeopen çœ‹åˆ° ribbon çš„ä»£ç ï¼Œç¬¬ä¸€çœ¼çœ‹åˆ°å…¶å®æ˜¯ä¸€è„¸æ‡µé€¼çš„ï¼Œä½†æ˜¯ä»”ç»†æƒ³ä¸€ä¸‹è¿˜æ˜¯è›®å®¹æ˜“çš„ã€‚
å¯ä»¥é€šè¿‡ä¿®æ”¹ä¸€ä¸‹ä»£ç å°±èƒ½å¤Ÿç«‹é©¬ç†è§£å•¦ ~
æˆ‘ä»¬æŠŠ `ctx.fillStyle` & `ctx.fill` éƒ½æ”¹æˆ stroke å°±æ˜ç™½åŸç†äº†ã€‚
å…¶å®æœ¬è´¨å°±æ˜¯ç»˜åˆ¶ä¸€ä¸ªæœ‰ä¸€å®šè§„å¾‹çš„æŠ˜çº¿ï¼Œç„¶åæŒ‰ç…§ä¸€ä¸ªè§„å¾‹å¡«å……é¢œè‰²å°±å¯ä»¥å®ç°äº†ã€‚

## å®ç°
### å‚æ•°å‡†å¤‡
```JavaScript
const pr = window.devicePixelRatio || 1;
const W = canvas.width = window.innerWidth * pr;
const H = canvas.height = window.innerHeight * pr;
const Hp = 0.7
const chartH = 90;
const pi = Math.PI * 2;
const cos = Math.cos;
let radius = 0;
let p;
```
- prï¼šå½“å‰æ˜¾ç¤ºè®¾å¤‡çš„ç‰©ç†åƒç´ åˆ†è¾¨ç‡ä¸CSSåƒç´ åˆ†è¾¨ç‡çš„æ¯”å€¼;
- Wã€Hï¼šcanvas ç”»å¸ƒçš„å®½é«˜ï¼›
- Hpï¼šå½©å¸¦åœ¨å¤§çº¦åœ¨ç”»å¸ƒ Y è½´çš„ä½ç½®ï¼ˆç”¨ç™¾åˆ†æ¯”è®¡ç®—ï¼‰ï¼›
- chartHï¼šå½©å¸¦é«˜åº¦çš„ 1 / 2ï¼›
- piï¼š360 åº¦çš„åœ†å‘¨å€¼ï¼›
- cosï¼šä½™å¼¦å‡½æ•°çš„è®¡ç®—æ–¹æ³•ï¼›
- radiusï¼šè§’åº¦å€¼ï¼›
- pï¼šå­˜æ”¾æŠ˜ç°æ‹ç‚¹çš„å®¹å™¨ï¼›

### åˆ›å»º
```JavaScript
function create() {
  ctx.clearRect(0, 0, W, H);
  p = [
    { x: 0, y: H * Hp + chartH },
    { x: 0, y: H * Hp - chartH },
  ];
  while(p[1].x < W) {
    draw(p[0], p[1]);
  }
}
```

è¿™é‡Œæˆ‘ä»¬åˆ›å»ºäº†ä¸¤ä¸ªåˆå§‹ç‚¹ï¼Œéƒ½æ˜¯ X è½´ 0 ç‚¹å¼€å§‹ï¼Œé«˜åº¦åˆ†åˆ«æ˜¯ç”»å¸ƒä¸­ç»˜åˆ¶ç‚¹çš„ä¸Šä¸‹å›ºå®šè·ç¦»ã€‚
éšåé€šè¿‡è¿­ä»£ï¼Œæˆ‘ä»¬å¼€å§‹ç»˜åˆ¶ï¼Œè¿™é‡Œæ˜æ˜¾æ˜¯åˆ†æ®µå¼çš„ç»˜åˆ¶ï¼Œç›´åˆ°ç»˜åˆ¶çš„æ‹ç‚¹åˆ°äº†ç”»å¸ƒçš„è¾¹ç¼˜ã€‚

### ç»˜åˆ¶
```JavaScript
function draw(p0, p1) {
  ctx.beginPath();
  ctx.moveTo(p0.x, p0.y);
  ctx.lineTo(p1.x, p1.y);
  const nx = calculateX(p1.x);
  const ny = calculateY(p1.y);
  ctx.lineTo(nx, ny);
  ctx.closePath();
  radius -= pi / -50;
  const color = '#' + (cos(radius) * 127 + 128 << 16 | cos(radius + pi / 3) * 127 + 128 << 8 | cos(radius + pi / 3 * 2) * 127 + 128).toString(16);
  ctx.fillStyle = color;
  ctx.fill();
  p[0] = p[1];
  p[1] = {
    x: nx,
    y: ny,
  };
}

function calculateX(x) {
  return x + (Math.random() * 2 - 0.25) * chartH;
}

function calculateY(y) {
  const cy = y + (Math.random() * 2 - 1.1) * chartH;
  return (cy > H || cy < 0) ? calculateY(y) : cy;
}
```
åˆ†æ®µå¼çš„ç»˜åˆ¶è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç”¨ p0 ä»£è¡¨ä¸Šä¸€ä¸ªæ‹ç‚¹ï¼Œp1 ä»£è¡¨å½“å‰çš„æ‹ç‚¹ï¼Œç„¶åç»˜åˆ¶çš„è¿‡ç¨‹ä¸­è®¡ç®—ä¸‹ä¸€ä¸ªæ‹ç‚¹çš„ä½ç½®ã€‚
è¿™é‡Œæˆ‘ä»¬ä»”ç»†çœ‹ä¸€ä¸‹å›¾å°±æ˜ç™½äº†å…¶å®è¿™ä¸ª ribbon å°±æ˜¯ç”±å¤šä¸ªä¸‰è§’å½¢ç»„æˆï¼Œæ‰€ä»¥æ¯ä¸ªåˆ†æ®µä¸­éƒ½éœ€è¦ç»˜åˆ¶ä¸‰ä¸ªç‚¹ã€‚fill æ—¶ä¼šè¿æ¥ç¬¬ä¸€ä¸ªç‚¹å’Œæœ€åä¸€ä¸ªç‚¹ã€‚

è‡³äº X ã€Y çš„è®¡ç®—å…¶å®å¯ä»¥è‡ªå·±éšæ„ç‚¹ï¼Œä¸å¿…å¤ªè¿‡çº ç»“è¿™é‡Œç»™å‡ºçš„å…¬å¼ã€‚

æœ€åå°±æ˜¯é¢œè‰²å€¼çš„å…¬å¼ï¼Œè¿™é‡Œçœ‹ä¸Šå»éå¸¸å¤æ‚ã€‚å…¶å®ä¸»è¦æ˜¯é€šè¿‡çº¿æ€§è®¡ç®— radius çš„å€¼ï¼Œç„¶ååœ¨å°†å€¼ä½œç”¨äºä½™å¼¦å‡½æ•°ä¸Šï¼Œå°±å¯ä»¥çœ‹åˆ°ä¸€ä¸ªæ¸å˜çš„æ•ˆæœã€‚
æ¥ç€æ˜¯ style çš„è¡¨ç¤ºæ–¹å¼ï¼Œè¿™é‡Œæ˜¯ç”¨çš„ web æ ¼å¼ï¼Œweb æ ¼å¼çš„é¢œè‰²å€¼ï¼Œå…¶å®æ˜¯ 16è¿›åˆ¶çš„ä¸‰ä¸ªæ•°å­—ç»„æˆçš„ï¼Œåˆ†åˆ«ä»£è¡¨äº†ä¸‰åŸè‰²ã€‚åŒç†æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ rgb çš„æ ¼å¼æ¥è®¡ç®—å’Œè¡¨ç¤ºï¼Œæˆ‘è®¤ä¸ºä¼šç›¸åº”çš„ç®€å•å¾ˆå¤šã€‚

## æ€»ç»“
å…¶å®å¯¹äºå¹³å¸¸çœ‹åˆ°çš„å¾ˆå¤šé…·ç‚«æ•ˆæœï¼Œéƒ½å¯ä»¥å» codeopen æœä¸€ä¸‹ï¼Œçœ‹ä¸Šå»éå¸¸å¤æ‚çš„ä¸œè¥¿ï¼Œä¹Ÿè®¸å¹¶æ²¡æœ‰æˆ‘ä»¬æƒ³çš„é‚£ä¹ˆå¤æ‚ã€‚
